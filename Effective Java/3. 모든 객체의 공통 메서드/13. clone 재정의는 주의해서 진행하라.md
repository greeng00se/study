> Joshua Blochë‹˜ì˜ Effective Java 3/Eë¥¼ ì½ê³  ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤.
> 

## clone ì¬ì •ì˜ëŠ” ì£¼ì˜í•´ì„œ ì§„í–‰í•˜ë¼

- clone() ë©”ì„œë“œê°€ ì˜ ë™ì‘í•˜ê²Œë” í•˜ëŠ” êµ¬í˜„ ë°©ë²•ê³¼, ì–¸ì œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ì§€, ë‹¤ë¥¸ ì„ íƒì§€ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì

### Cloneable

- ë³µì œí•´ë„ ë˜ëŠ” í´ë˜ìŠ¤ì„ì„ ëª…ì‹œí•˜ëŠ” ìš©ë„ì˜ ë¯¹ìŠ¤ì¸ ì¸í„°í˜ì´ìŠ¤ë‹¤.
- Objectì˜ protected ë©”ì„œë“œì¸ cloneì˜ ë™ì‘ ë°©ì‹ì„ ê²°ì •í•œë‹¤.
- Cloneableì„ êµ¬í˜„í•˜ì§€ ì•Šì€ í´ë˜ìŠ¤ì—ì„œ `clone()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ `CloneNotSupportedException`ì„ ë˜ì§„ë‹¤.

> ğŸ“ŒÂ ë¯¹ìŠ¤ì¸(mix-in)
> 
> - í´ë˜ìŠ¤ê°€ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” íƒ€ì…ìœ¼ë¡œ, ë¯¹ìŠ¤ì¸ì„ êµ¬í˜„í•˜ë©´ íŠ¹ì • ì„ íƒì  í–‰ìœ„ë¥¼ ì œê³µí•œë‹¤ê³  ì„ ì–¸í•œë‹¤.
> - ì˜ˆ) `Comparable`ì€ ìì‹ ì„ êµ¬í˜„í•œ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë“¤ë¼ë¦¬ëŠ” ìˆœì„œë¥¼ ì •í•  ìˆ˜ ìˆë‹¤ê³  ì„ ì–¸í•œë‹¤.

### clone ì¬ì •ì˜ ê·œì•½

- ì•„ë˜ ë‘ ê·œì•½ì€ ë¬´ì¡°ê±´ ì°¸ì´ë‹¤.
    - `x.clone() â‰  x`
    - `x.clone().getClass() == x.getClass()`
- ì•„ë˜ ê·œì•½ì€ ì¼ë°˜ì ìœ¼ë¡œ ì°¸ì´ì§€ë§Œ, í•„ìˆ˜ëŠ” ì•„ë‹ˆë‹¤.
    - `x.clone().equals(x)`
- `clone()` ë©”ì„œë“œê°€ ë°˜í™˜í•˜ëŠ” ê°ì²´ëŠ” `super.clone()` ì„ í˜¸ì¶œí•´ ì–»ì–´ì•¼ í•œë‹¤.
    - ìƒì„±ìë¥¼ ì´ìš©í•´ ì–»ëŠ” ê²½ìš° í•´ë‹¹ í´ë˜ìŠ¤ì˜ í•˜ìœ„ í´ë˜ìŠ¤ê°€ `super.clone()` ìœ¼ë¡œ ê°’ì„ ê°€ì ¸ì˜¬ ë•Œ í•˜ìœ„ í´ë˜ìŠ¤ëŠ” ìƒìœ„ í´ë˜ìŠ¤ì˜ íƒ€ì…ì„ ë°˜í™˜í•  ìˆ˜ ë°–ì— ì—†ë‹¤ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.
- ë°˜í™˜ëœ ê°ì²´ì™€ ì›ë³¸ ê°ì²´ëŠ” ë…ë¦½ì ì´ì–´ì•¼ í•œë‹¤.
    - `super.clone()` ë©”ì„œë“œë¡œ ì–»ì€ í•„ë“œ ì¤‘ ê³ ìœ í•œ idê°’ê³¼ ê°™ì´ í•´ë‹¹ ê°ì²´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°’ì´ ìˆëŠ” ê²½ìš° ë°˜í™˜ ì „ ìˆ˜ì •í•´ì•¼ í•œë‹¤.

## clone ì¬ì •ì˜ ë°©ë²•

### ê°€ë³€ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ê²½ìš°

```java
@EqualsAndHashCode
@RequiredArgsConstructor
public class Point implements Cloneable {
    private final int x;
    private final int y;

    @Override
    public Point clone() {
        try {
            return (Point) super.clone();
        } catch (CloneNotSupportedException e) {
            throw new AssertionError();
        }
    }
}
```

- í´ë˜ìŠ¤ì˜ ì„ ì–¸ë¶€ì— Cloneableì„ êµ¬í˜„í•œë‹¤ê³  ì¶”ê°€í•œë‹¤.
- `Object.clone()` ë©”ì„œë“œëŠ” Objectë¥¼ ë°˜í™˜í•˜ì§€ë§Œ ìë°”ì˜ ê³µë³€ ë°˜í™˜ íƒ€ì´í•‘ì„ ì´ìš©í•˜ì—¬ ì¬ì •ì˜ í´ë˜ìŠ¤ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆë‹¤.
    - ê³µë³€ì„±ì„ ì‚¬ìš©í•˜ì—¬ ë©”ì„œë“œë¥¼ ì •ì˜í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ ìª½ì—ì„œ í˜•ë³€í™˜í•  í•„ìš”ê°€ ì—†ë‹¤.
- `super.clone()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´, ì™„ë²½í•œ ë³µì œë³¸ì„ ê°€ì ¸ì˜¨ë‹¤. ë³µì œë³¸ì„ ë°˜í™˜í•˜ê¸° ì „ì— í˜•ë³€í™˜ í•´ì¤€ë‹¤.
- `object.clone()` ë©”ì„œë“œê°€ ê²€ì‚¬ ì˜ˆì™¸ì¸ `CloneNotSupportedException`ì„ ë˜ì§€ê¸° ë•Œë¬¸ì— `try-catch`ê°€ í•„ìš”í•˜ë‹¤.
    - Cloneableì„ êµ¬í˜„í•˜ë‹ˆ í•´ë‹¹ ì˜ˆì™¸ëŠ” ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

> ğŸ“ŒÂ ê³µë³€ ë°˜í™˜ íƒ€ì´í•‘(convariant return typing)
> 
> - ì¬ì •ì˜í•œ ë©”ì„œë“œì˜ ë°˜í™˜ íƒ€ì…ì€ ìƒìœ„ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œê°€ ë°˜í™˜í•˜ëŠ” íƒ€ì…ì˜ í•˜ìœ„ íƒ€ì…ì¼ ìˆ˜ ìˆë‹¤.
> - JDK 5.0ë¶€í„° ì§€ì›

### ê°€ë³€ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” ê²½ìš°

- ê°€ë³€ ê°ì²´ë¥¼ ì°¸ì¡°í•  ë•Œ  `clone()` ë©”ì„œë“œê°€ ë‹¨ìˆœíˆ `super.clone()` ì˜ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ë©´ ë¬¸ì œê°€ ìƒê¸´ë‹¤.
    - ë°°ì—´ì˜ ê²½ìš° ê°™ì€ ë°°ì—´ì„ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì— ì›ë³¸ì´ë‚˜ ë³µì œë³¸ ì¤‘ í•˜ë‚˜ë¥¼ ìˆ˜ì •í•˜ë©´, ë‹¤ë¥¸ í•˜ë‚˜ë„ ë³€ê²½ëœë‹¤.
- cloneì€ ìƒì„±ìì™€ ê°™ì€ íš¨ê³¼ë¥¼ ë‚´ê¸° ë•Œë¬¸ì—, ê¸°ë³¸ ê°ì²´ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šì•„ì•¼ ëœë‹¤.

```java
public class Stack implements Cloneable {
    private Object[] elements;
    private int size = 0;

    @Override
    public Stack clone() {
        try {
            Stack result = (Stack) super.clone();
            result.elements = elements.clone();
            return result;
        } catch (CloneNotSupportedException e) {
            throw new AssertionError();
        }
    }
}
```

- ê°€ì¥ ê°„ë‹¨í•œ êµ¬í˜„ ë°©ë²•ì€ ê°€ë³€ ê°ì²´ì˜ `clone()`ì„ ì¬ê·€ì ìœ¼ë¡œ í˜¸ì¶œí•˜ëŠ” ë°©ë²•ì´ë‹¤.
- í•˜ì§€ë§Œ elements í•„ë“œê°€ finalì¼ ê²½ìš° í•´ë‹¹ ë°©ì‹ì€ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤.

### ë³µì¡í•œ ê°€ë³€ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ëŠ” ê²½ìš°

```java
public class HashTable implements Cloneable {
    private Entry[] buckets;

    private static class Entry {
        final Object key;
        Object value;
        Entry next;

        public Entry(Object key, Object value, Entry next) {
            this.key = key;
            this.value = value;
            this.next = next;
        }
    }

    @Override
    public HashTable clone() {
        try {
            HashTable result = (HashTable) super.clone();
            result.buckets = buckets.clone();
            return result;
        } catch (CloneNotSupportedException e) {
            throw new AssertionError();
        }
    }
}
```

- ì—°ê²°ë¦¬ìŠ¤íŠ¸ì™€ ê°™ì´ ê°€ë³€ ê°ì²´ ë‚´ë¶€ì— ë˜ ë‹¤ë¥¸ ê°€ë³€ ê°ì²´ë¥¼ ê°€ì§€ê³  ìˆëŠ” ê²½ìš° ê°€ë³€ ê°ì²´ì˜ `clone()`ì„ í˜¸ì¶œí•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ ë¬¸ì œê°€ ìƒê¸´ë‹¤.
    - ë‚´ë¶€ì˜ ê°ì²´ë“¤ì€ ì—¬ì „íˆ ì´ì „ì˜ ê°ì²´ë“¤ì„ ê°€ë¦¬í‚¤ê³  ìˆì–´ì„œ, ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤.

```java
Entry deepCopy() {
    return new Entry(key, value, next == null ? null : next.deepCopy());
}

...

@Override
public HashTable clone() {
    try {
        HashTable result = (HashTable) super.clone();
        result.buckets = new Entry[buckets.length];
        for (int i = 0; i < buckets.length; i++)
            if (buckets[i] != null)
                result.buckets[i] = buckets[i].deepCopy();
        return result;
    } catch (CloneNotSupportedException e) {
        throw new AssertionError();
    }
}
```

- ì¼ë°˜ì ì¸ í•´ê²°ë°©ë²•ìœ¼ë¡œ, Entry í´ë˜ìŠ¤ì—ì„œ ê¹Šì€ ë³µì‚¬ë¥¼ ì§€ì›í•˜ë„ë¡í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.
- í•˜ì§€ë§Œ ì´ ë°©ë²•ì€ ì¬ê·€ í˜¸ì¶œ ë•Œë¬¸ì— ë¦¬ìŠ¤íŠ¸ì˜ ì›ì†Œ ìˆ˜ ë§Œí¼ ìŠ¤íƒ í”„ë ˆì„ì„ ì†Œë¹„í•˜ì—¬ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ì¼ìœ¼í‚¬ ìœ„í—˜ì´ ìˆë‹¤.

```java
Entry deepCopy() {
    Entry result = new Entry(key, value, next);
    for (Entry p = result; p.next != null; p = p.next)
        p.next = new Entry(p.next.key, p.next.value, p.next.next);

    return result;
}
```

- Entry í´ë˜ìŠ¤ì—ì„œ ì¬ê·€ ëŒ€ì‹  ë°˜ë³µìë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆœíšŒí•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ìœ„í—˜ ìƒí™©ì„ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

### ì¬ì •ì˜ ì‹œ ì£¼ì˜ì‚¬í•­

- publicì¸ `clone()` ë©”ì„œë“œì—ì„œëŠ” ê²€ì‚¬ ì˜ˆì™¸ì¸ `CloneNotSupportedException` ë˜ì§€ì§€ ì•Šë„ë¡ êµ¬í˜„í•˜ê¸°
    - ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ê¸° í¸í•˜ë„ë¡ ì˜ˆì™¸ ì „í™˜ì„ í•œë‹¤.
- ìƒì†ìš© í´ë˜ìŠ¤ëŠ” Cloneableì„ êµ¬í˜„í•´ì„œëŠ” ì•ˆëœë‹¤.
    - ì•„ë˜ì™€ ê°™ì´ í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œ Cloneableì„ ì§€ì›í•˜ì§€ ëª»í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

```java
@Override
protected final Object clone() throws CloneNotSupportedException {
    throw new CloneNotSupportedException()
}
```

- Cloneableì„ êµ¬í˜„í•œ thread-safe í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•  ë•ŒëŠ” `clone()` ë©”ì„œë“œë„ ì ì ˆíˆ ë™ê¸°í™”í•´ì•¼ í•œë‹¤.

## ë³µì‚¬ë¥¼ ìœ„í•œ ë‹¤ë¥¸ ì„ íƒì§€ëŠ” ì—†ì„ê¹Œ?

- `clone()` ë©”ì„œë“œë¥¼ ì¬ì •ì˜í•˜ëŠ” ê²ƒì€ ë³µì¡í•˜ë‹¤.
- ì¬ì •ì˜ë¥¼ í•˜ì§€ ì•Šê³  ë³µì‚¬ ìƒì„±ìì™€ ë³µì‚¬ íŒ©í„°ë¦¬ë¼ëŠ” ê°ì²´ ë³µì‚¬ ë°©ì‹ì„ ì œê³µí•  ìˆ˜ ë„ ìˆë‹¤.

### ë³µì‚¬ ìƒì„±ì

- `public Book(Book book) { ... }`
- ìì‹ ê³¼ ê°™ì€ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¸ìˆ˜ë¡œ ë°›ëŠ” ìƒì„±ìë‹¤.

### ë³µì‚¬ íŒ©í„°ë¦¬

- `public static Book newInstance(Book book) { ... }`
- ì •ì  íŒ©í„°ë¦¬ ë©”ì„œë“œë¥¼ í™œìš©í•˜ì—¬ ìœ ì—°í•˜ê²Œ ê°ì²´ë¥¼ ë³µì‚¬ í•  ìˆ˜ ìˆë‹¤.

### ë³µì‚¬ ìƒì„±ìì™€ ë³µì‚¬ íŒ©í„°ë¦¬ì˜ ì¥ì 

- ì •ìƒì ì¸ final í•„ë“œ ìš©ë²•ê³¼ ì¶©ëŒí•˜ì§€ ì•ŠëŠ”ë‹¤.
- ë¶ˆí•„ìš”í•œ ê²€ì‚¬ ì˜ˆì™¸ë¥¼ ë˜ì§€ì§€ ì•ŠëŠ”ë‹¤.
- í˜•ë³€í™˜ì´ í•„ìš” ì—†ë‹¤.
- í•´ë‹¹ í´ë˜ìŠ¤ê°€ êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ íƒ€ì…ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¸ìˆ˜ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.
    - ì»¬ë ‰ì…˜ êµ¬í˜„ì²´ëŠ” Collectionì´ë‚˜ Map íƒ€ì…ì„ ë°›ëŠ” ìƒì„±ìë¥¼ ì œê³µí•œë‹¤.
    - ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ ë³µì‚¬ ìƒì„±ìì™€ ë³µì‚¬ íŒ©í„°ë¦¬ë¥¼ ë³€í™˜ ìƒì„±ìì™€ ë³€í™˜ íŒ©í„°ë¦¬ë¼ê³  ë¶ˆë¦°ë‹¤.

## ì •ë¦¬

- Cloneableì„ í™•ì¥í•˜ê³  `clone()` ë©”ì„œë“œë¥¼ ì¬ì •ì˜í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ë³µì¡í•˜ë‹¤.
    - ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ë‹¤.
- ë³µì œ ê¸°ëŠ¥ì€ ìƒì„±ìì™€ íŒ©í„°ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
- ë‹¨, ë°°ì—´ì„ ë³µì œí•˜ëŠ” ê²½ìš° `clone()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ìª½ì´ ê¹”ë”í•˜ë‹¤.
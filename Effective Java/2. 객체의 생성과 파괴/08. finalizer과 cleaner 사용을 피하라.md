> Joshua Blochë‹˜ì˜ Effective Java 3/Eë¥¼ ì½ê³  ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤.
> 

## finalizerê³¼ cleaner ì‚¬ìš©ì„ í”¼í•˜ë¼

- ìë°”ëŠ” ê°ì²´ ì†Œë©¸ìë¡œ `finalizer`ì™€ `cleaner`ë¥¼ ì§€ì›í•œë‹¤.
- ìë°” 9ì—ì„œëŠ” `finalizer`ê°€ deprecated ë˜ê³  `cleaner` ê°€ ëŒ€ì•ˆìœ¼ë¡œ ì†Œê°œë˜ì—ˆì§€ë§Œ(ë³„ë„ì˜ ìŠ¤ë ˆë“œ ì‚¬ìš©), ë§ˆì°¬ê°€ì§€ë¡œ ì˜ˆì¸¡í•  ìˆ˜ ì—†ê³ , ëŠë¦¬ê³ , ë¶ˆí•„ìš”í•˜ë‹¤.

## finalizerì™€ cleanerì˜ ë‹¨ì 

### ë‹¨ì  1. ìˆ˜í–‰ ì‹œì ì„ ì˜ˆì¸¡í•  ìˆ˜ ì—†ë‹¤.

- ì¦‰ì‹œ ìˆ˜í–‰ëœë‹¤ëŠ” ë³´ì¥ì´ ì—†ê³ , ì‹¤í–‰ê¹Œì§€ ì–¼ë§ˆê°€ ê±¸ë¦´ì§€ ì•Œ ìˆ˜ ì—†ë‹¤.
- ë™ì‘ì€ GCì˜ ì•Œê³ ë¦¬ì¦˜ì— ë‹¬ë ¸ìœ¼ë©° ìš°ì„ ìˆœìœ„ë„ ë‚®ê¸° ë•Œë¬¸ì— ë§Œì•½ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” ì‘ì—…ì„ í•œë‹¤ë©´ ìì›ë°˜í™˜ì´ ì•ˆë˜ì„œ `OutOfMemoryError` ê°€ ë°œìƒ í•  ìˆ˜ë„ ìˆë‹¤.

### ë‹¨ì  2. ìˆ˜í–‰ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ë‹¤.

- ìˆ˜í–‰ ì—¬ë¶€ë¥¼ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ìƒíƒœë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ìˆ˜ì •í•˜ëŠ” ì‘ì—…ì— ì ˆëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ ì•ˆëœë‹¤.
- ë°ì´í„°ë² ì´ìŠ¤ì™€ ê°™ì€ ê³µìœ  ìì›ì˜ ì˜êµ¬ ë½ í•´ì œí•˜ëŠ” ì½”ë“œê°€ ë‹´ê²¨ ìˆì„ ê²½ìš°, ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•Šì•„ì„œ ì‹œìŠ¤í…œ ì „ì²´ê°€ ë©ˆì¶œ ìˆ˜ ë„ ìˆë‹¤.

### ë‹¨ì  3. ì˜ˆì™¸ê°€ ë¬´ì‹œëœë‹¤.

- `finalizer` ë™ì‘ ì¤‘ ë°œìƒí•œ ì˜ˆì™¸ëŠ” ë¬´ì‹œë˜ê³  ë™ì‘í•´ì•¼ í•˜ëŠ” ì‘ì—…ì´ ë‚¨ì•„ìˆì–´ë„ ë°”ë¡œ ì¢…ë£Œëœë‹¤.
- `cleaner`ì˜ ê²½ìš°ì—ëŠ” ìì‹ ì˜ ìŠ¤ë ˆë“œë¥¼ í†µì œí•˜ê¸° ë•Œë¬¸ì— ì´ëŸ° ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

### ë‹¨ì  4. ì„±ëŠ¥ ë¬¸ì œë„ ì‹¬ê°í•˜ë‹¤.

- `try-with-resources`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì¢…ë£Œí•˜ëŠ” ë°©ë²•ë³´ë‹¤ ìˆ˜ì‹­ë°° ëŠë¦¬ë‹¤.
- í•˜ì§€ë§Œ ê°ì²´ë¥¼ ë°˜í™˜í•  ë•Œ ì•ˆì „ë§ í˜•íƒœë¡œë§Œ ì‚¬ìš©í•œë‹¤ë©´ ì•½ 5ë°° ì •ë„ë§Œ ëŠë ¤ì§„ë‹¤.

### ë‹¨ì  5. finalizer ê³µê²©ì— ë…¸ì¶œë˜ê¸° ë•Œë¬¸ì— ë³´ì•ˆì— ì·¨ì•½í•˜ë‹¤.

- ìƒì„±ìë‚˜ ì§ë ¬í™” ê³¼ì •ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ í´ë˜ìŠ¤ê°€ ìƒì†ë°›ì€ `finalize()` ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ ë¶€ê°€ì ì¸ ì‘ì—…ì„ í•  ìˆ˜ ìˆë‹¤.
    - ì •ì  í•„ë“œì— ìê¸° ìì‹ ì˜ ì°¸ì¡°ë¥¼ í• ë‹¹í•˜ì—¬ GCê°€ ìˆ˜ì§‘ì„ ëª»í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.
    - ì•…ì˜ì ì¸ ì½”ë“œë¥¼ ìƒì†ë°›ì€ `finalize()` ë©”ì„œë“œë¥¼ í†µí•´ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆë‹¤.
    - ì´ë¯¸ ë¹Œë“œë˜ì„œ ì»´íŒŒì¼ëœ í´ë˜ìŠ¤ íŒŒì¼ë§Œ ì°¸ì¡°í•  ìˆ˜ ìˆìœ¼ë©´ í´ë˜ìŠ¤íŒ¨ìŠ¤ì— ì¶”ê°€í•´ì„œ ê³µê²©ì´ ê°€ëŠ¥í•˜ë‹¤.
- final í´ë˜ìŠ¤ëŠ” í•˜ìœ„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë‹ˆ ì´ ê³µê²©ì— ì•ˆì „í•˜ë‹¤.
- finalì´ ì•„ë‹Œ í´ë˜ìŠ¤ì—ì„œëŠ” ì•„ë¬´ëŸ° ì‘ì—…ë„ í•˜ì§€ ì•ŠëŠ” `finalize()` ë©”ì„œë“œë¥¼ ë§Œë“¤ê³  finalë¡œ ì„ ì–¸í•˜ì—¬ ë§‰ì„ ìˆ˜ ìˆë‹¤.

## finalizerì™€ cleanerì˜ ëŒ€ì•ˆ

### AutoClosealbe êµ¬í˜„

- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš© í›„ `close()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ëœë‹¤.(`try-with-resources` ì‚¬ìš©, Item 09)
- ê° ì¸ìŠ¤í„´ìŠ¤ëŠ” `close()` ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³ , ê°ì²´ê°€ ë‹«íŒ í›„ì—ë„ í˜¸ì¶œì´ ë˜ì—ˆë‹¤ë©´ `IllegalStateException` ì„ ë°œìƒì‹œí‚¤ëŠ” ê²ƒì´ ì¢‹ë‹¤.

## finalizerì™€ cleanerì˜ ìš©ë„

- ê·¸ë ‡ë‹¤ë©´ ì–´ë””ì— ì‚¬ìš©í•  ìˆ˜ ìˆì„ê¹Œ?

### ì•ˆì „ë§ ì—­í• 

- ìì›ì˜ ì†Œìœ ìê°€ `close()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ” ê²ƒì— ëŒ€ë¹„í•œ ì•ˆì „ë§ ì—­í• ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ìë°” ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì¼ë¶€ í´ë˜ìŠ¤ëŠ” ì•ˆì „ë§ ì—­í• ì˜ finalizerë¥¼ ì œê³µí•œë‹¤.
    - `FileInputStream`
    - `FileOutputStream`
    - `ThreadPoolExecutor`

### ë„¤ì´í‹°ë¸Œ í”¼ì–´(native peer) ì—°ê²° ê°ì²´

- ë„¤ì´í‹°ë¸Œ í”¼ì–´ë€ ì¼ë°˜ ìë°” ê°ì²´ê°€ ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œë¥¼ í†µí•´ ê¸°ëŠ¥ì„ ìœ„ì„í•œ ê°ì²´ë¥¼ ë§í•œë‹¤.
- ë„¤ì´í‹°ë¸Œ í”¼ì–´ëŠ” ìë°” ê°ì²´ê°€ ì•„ë‹ˆë¼ GCê°€ ì¡´ì¬ë¥¼ ì•Œì§€ ëª»í•œë‹¤.
- ì´ ê²½ìš°ì—ë„ ì„±ëŠ¥ ì €í•˜ê°€ ìš°ë ¤ë˜ê±°ë‚˜ ìì›ì„ ì¦‰ì‹œ íšŒìˆ˜í•´ì•¼ í•˜ëŠ” ê²½ìš° `close()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

> ğŸ“ŒÂ  ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œ(native method)
> 
> - Cë‚˜ C++ê°™ì€ ë„¤ì´í‹°ë¸Œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¡œ ì‘ì„±í•œ ë©”ì„œë“œ

## cleaner ì‚¬ìš©

```java
public class Room implements AutoCloseable {
    private static final CleanerCLEANER= Cleaner.create();

    // ë°©ì˜ ìƒíƒœ. cleanableê³¼ ê³µìœ í•œë‹¤.
    private final State state;

    // cleanalbe ê°ì²´, ìˆ˜ê±° ëŒ€ìƒì´ ë˜ë©´ ë°©ì„ ì²­ì†Œí•œë‹¤.
    private final Cleaner.Cleanable cleanable;

    public Room() {
        this.state = new State();
        this.cleanable = CLEANER.register(this, state);
    }

    @Override
    public void close() throws Exception {
        cleanable.clean();
    }

    // Roomì„ ì°¸ì¡°í•´ì„œëŠ” ì•ˆëœë‹¤.
    private static class State implements Runnable {
        @Override
        public void run() {
            System.out.println("ì²­ì†Œ");
        }
    }
}
```

- StateëŠ” ìˆ˜ê±°í•  ìì›ì„ ê°€ì§ˆ ìˆ˜ ìˆê³ , í´ë¦¬ë„ˆë¥¼ ë„¤ì´í‹°ë¸Œ í”¼ì–´ë¥¼ ìœ„í•´ ì‚¬ìš©í•  ê²½ìš° ë„¤ì´í‹°ë¸Œ í”¼ì–´ë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„°ë¥¼ ë‹´ì€ ë³€ìˆ˜ë¥¼ ê°€ì§€ê³  ìˆì–´ì•¼ í•œë‹¤.
- StateëŠ” Runnableì„ êµ¬í˜„í•˜ê³ , `run()` ë©”ì„œë“œëŠ” cleanableì— ì˜í•´ ë‹¨ í•œ ë²ˆë§Œ í˜¸ì¶œëœë‹¤.
- í˜¸ì¶œë˜ëŠ” ìƒí™©ì€ ë‘ ê°€ì§€ë‹¤.
    - `Room.close()` ë©”ì„œë“œë¥¼ í˜¸ì¶œ í•  ê²½ìš°
    - GCê°€ Roomì„ íšŒìˆ˜í•  ê²½ìš°(`clean() ë©”ì„œë“œ` í˜¸ì¶œì„ ì˜ˆì¸¡í•  ìˆ˜ ì—†ë‹¤.)
- ìœ„ ì½”ë“œì—ì„œ State í´ë˜ìŠ¤ëŠ” ì ˆëŒ€ë¡œ Room ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ë©´ ì•ˆëœë‹¤.
    - ìˆœí™˜ ì°¸ì¡°ê°€ ìƒê²¨ GCê°€ Room ì¸ìŠ¤í„´ìŠ¤ë¥¼ íšŒìˆ˜í•˜ì§€ ì•ŠëŠ”ë‹¤.

## ì •ë¦¬

- finalizerì™€ cleanerëŠ” ë˜ë„ë¡ì´ë©´ ì‚¬ìš©ì„ í”¼í•˜ê³  íŠ¹ì • ìƒí™©ì¼ ê²½ìš°ì—ë§Œ ê³ ë ¤í•˜ì
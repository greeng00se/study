> Real MySQL 8.0ÏùÑ ÏùΩÍ≥† Ï†ïÎ¶¨Ìïú Í∏ÄÏûÖÎãàÎã§.
> 

## InnoDB Ïä§ÌÜ†Î¶¨ÏßÄ ÏóîÏßÑ Ïû†Í∏à

- MySQLÏóêÏÑú Ï†úÍ≥µÌïòÎäî Ïû†Í∏àÍ≥º Î≥ÑÍ∞úÎ°ú Ïä§ÌÜ†Î¶¨ÏßÄ ÏóîÏßÑ ÎÇ¥Î∂ÄÏóêÏÑú Î°úÏö∞ Îã®ÏúÑÏùò Ïû†Í∏àÏùÑ ÏßÄÏõêÌïúÎã§.
- Î≥¥ÌÜµ Î™ÖÏãúÏ†ÅÏúºÎ°ú Ïû†Í∏àÏùÑ ÏÇ¨Ïö©ÌïòÎäî Í≤ΩÏö∞Îäî ÎìúÎ¨ºÍ≥†, Í≤©Î¶¨ ÏàòÏ§ÄÏóê Îî∞Îùº Î¨µÏãúÏ†ÅÏúºÎ°ú Ïû†Í∏àÏù¥ ÏÇ¨Ïö©ÎêúÎã§.
- InnoDBÎäî ÎπÑÍ¥ÄÏ†Å Ïû†Í∏à Î∞©ÏãùÏùÑ ÏÇ¨Ïö©ÌïúÎã§.

> üìå¬†ÎπÑÍ¥ÄÏ†Å ÎèôÏãúÏÑ± Ï†úÏñ¥(PCC, Pessimistic Concurrency Control)
> 
> - ÎπÑÍ¥ÄÏ†Å ÎùΩÏù¥ÎùºÍ≥†ÎèÑ ÌïòÎ©∞ Ìä∏ÎûúÏû≠ÏÖòÏù¥ Ï∂©ÎèåÌïòÎäî Í∞ÄÏ†ïÌïòÏóê Ïû†Í∏àÏùÑ Í±∞Îäî Î∞©Ïãù
> - ÏùºÎ∞òÏ†ÅÏúºÎ°ú¬†Shared Lock, Exclusive LockÏùÑ ÌÜµÌï¥ Ïù¥Î•º Íµ¨ÌòÑÌïúÎã§.

> üìå¬†ÎÇôÍ¥ÄÏ†Å ÎèôÏãú ÏàòÌñâ Ï†úÏñ¥(OCC, Optimistic concurrency control)
> 
> - ÎÇôÍ¥ÄÏ†Å ÎùΩÏù¥ÎùºÍ≥†ÎèÑ ÌïòÎ©∞ Ìä∏ÎûúÏû≠ÏÖòÏù¥ ÏÑúÎ°ú Ï∂©ÎèåÌïòÏßÄ ÏïäÎäîÎã§Í≥† Í∞ÄÏ†ïÌïòÎäî Î∞©Ïãù
> - Î†àÏΩîÎìú Ïû†Í∏àÏùÑ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÎäî Í¥ÄÍ≥ÑÌòï Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïóê ÏÇ¨Ïö©ÎêòÎäî ÎèôÏãúÏÑ± Ï†úÏñ¥ Î∞©Î≤ïÏù¥Îã§.

### Shared & Exclusive Locks

- InnoDBÎäî Î°úÏö∞ Îã®ÏúÑÏùò Ïû†Í∏àÏùÑ ÏàòÌñâÌï† Îïå Read(S) Write(X) Ïû†Í∏àÏùÑ ÏÇ¨Ïö©ÌïúÎã§.
- Í≥µÏú† Ïû†Í∏à(S, shared lock)
    - Îç∞Ïù¥ÌÑ∞ Ï°∞ÌöåÎ•º ÏúÑÌïú ÎùΩ, ÏùΩÍ∏∞ Ïû†Í∏à(read lock)ÏúºÎ°úÎèÑ Î∂àÎ¶∞Îã§.
    - Îã§Î•∏ Ìä∏ÎûúÏû≠ÏÖòÏóêÏÑú ÏùΩÍ∏∞Í∞Ä Í∞ÄÎä•ÌïòÏßÄÎßå, Ïì∞Í∏∞Îäî Î∂àÍ∞ÄÎä•ÌïòÎã§.
    - Ïòà) `SELECT * FROM table_name WHERE id = 1 LOCK IN SHARE MODE;`
- Î∞∞ÌÉÄÏ†Å Ïû†Í∏à(X, exclusive lock)
    - Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤ΩÏùÑ ÏúÑÌïú ÎùΩ, Ïì∞Í∏∞ Ïû†Í∏à(write lock)ÏúºÎ°úÎèÑ Î∂àÎ¶∞Îã§.
    - ÎùΩÏùÑ Í±¥ Ìä∏ÎûúÏû≠ÏÖòÎßåÏù¥ Ìï¥Îãπ Îç∞Ïù¥ÌÑ∞Ïóê Ï†ëÍ∑º Í∞ÄÎä•ÌïòÎã§. Îã§Î•∏ Ìä∏ÎûúÏû≠ÏÖòÏùò Í≤ΩÏö∞ ÏùΩÍ∏∞, Ïì∞Í∏∞Í∞Ä Î∂àÍ∞ÄÎä•ÌïòÎã§.
    - Ïòà) `SELECT * FROM table_name WHERE id = 1 FOR UPDATE;`

### Intention Locks

- InnoDBÎäî Î°úÏö∞ Îã®ÏúÑ Ïû†Í∏àÍ≥º ÌÖåÏù¥Î∏î Ïû†Í∏àÏùò Í≥µÏ°¥ÏùÑ ÏúÑÌï¥ Ïù∏ÌÖçÏÖò Ïû†Í∏àÏùÑ ÏßÄÏõêÌïúÎã§.
- ÌÖåÏù¥Î∏îÏóê ÏûàÎäî Î°úÏö∞Ïóê ÎåÄÌï¥ÏÑú ÎÇòÏ§ëÏóê ÏöîÏ≤≠ÎêòÎäî Í≤ÉÏù¥ Ïñ¥Îñ§ ÌòïÌÉúÏùò Ïû†Í∏àÏù∏ÏßÄ Í∞ÄÎ¶¨ÌÇ§Í∏∞ ÏúÑÌï¥ ÏÇ¨Ïö©ÎêúÎã§.
- Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Î°úÏö∞ Îã®ÏúÑ Ïû†Í∏àÏùÑ ÏàòÌñâÌïòÍ∏∞ Ï†ÑÏóê Ïù∏ÌÖêÏÖò Ïû†Í∏àÏùÑ Î®ºÏ†Ä ÌöçÎìùÌïúÎã§.
- Ïù∏ÌÖêÏÖò Í≥µÏú† Ïû†Í∏à(IS, intention shared lock)
    - Ìä∏ÎûúÏû≠ÏÖòÏù¥ ÌÖåÏù¥Î∏îÏùò Í∞úÎ≥Ñ Î°úÏö∞Ïóê ÎåÄÌïú Í≥µÏú† Ïû†Í∏àÏùÑ ÏàòÌñâÌïòÎäî Í≤ÉÏùÑ ÎÇòÌÉúÎÇ∏Îã§.
- Ïù∏ÌÖêÏÖò Î∞∞ÌÉÄÏ†Å Ïû†Í∏à(IX, intention exclusive lock)
    - Ìä∏ÎûúÏû≠ÏÖòÏù¥ ÌÖåÏù¥Î∏îÏùò Í∞úÎ≥Ñ Î°úÏö∞Ïóê ÎåÄÌïú Î∞∞ÌÉÄÏ†Å Ïû†Í∏àÏùÑ ÏàòÌñâÌïòÎäî Í≤ÉÏùÑ ÎÇòÌÉúÎÇ∏Îã§.

|  | X | IX | S | IS |
| --- | --- | --- | --- | --- |
| X | Conflict | Conflict | Conflict | Conflict |
| IX | Conflict | Compatible | Conflict | Compatible |
| S | Conflict | Conflict | Compatible | Compatible |
| IS | Conflict | Compatible | Compatible | Compatible |
- Ïû†Í∏àÍ∞ÑÏùò Ìò∏ÌôòÏÑ±ÏùÄ ÏúÑÏôÄ Í∞ôÎã§.

 

### Record Locks

- Î†àÏΩîÎìú ÏûêÏ≤¥ÎßåÏùÑ Ïû†Í∑∏Îäî ÎùΩÏù¥Îã§.
- InnoDB Ïä§ÌÜ†Î¶¨ÏßÄ ÏóîÏßÑÏùÄ Î†àÏΩîÎìú ÏûêÏ≤¥Í∞Ä ÏïÑÎãàÎùº Ïù∏Îç±Ïä§Ïùò Î†àÏΩîÎìúÎ•º Ïû†Í∑ºÎã§.

### Gap Locks

- Î†àÏΩîÎìúÏôÄ Î∞îÎ°ú Ïù∏Ï†ëÌïú Î†àÏΩîÎìú ÏÇ¨Ïù¥Ïùò Í∞ÑÍ≤©ÎßåÏùÑ Ïû†Í∑∏Îäî ÎùΩÏù¥Îã§.
- Î†àÏΩîÎìúÏôÄ Î†àÏΩîÎìú ÏÇ¨Ïù¥Ïùò Í∞ÑÍ≤©Ïóê ÏÉàÎ°úÏö¥ Î†àÏΩîÎìúÍ∞Ä ÏÉùÏÑ±ÎêòÎäî Í≤ÉÏùÑ Ï†úÏñ¥ÌïòÍ≥†, ÎÑ•Ïä§Ìä∏ ÌÇ§ ÎùΩÏùò ÏùºÎ∂ÄÎ°ú ÏÇ¨Ïö©ÎêúÎã§.

### Next-Key Locks

- Î†àÏΩîÎìú ÎùΩÍ≥º Í∞≠ ÎùΩÏùÑ Ìï©Ï≥êÎÜìÏùÄ ÌòïÌÉúÏùò Ïû†Í∏àÏúºÎ°ú Î†àÏΩîÎìúÏôÄ Í∑∏ Î†àÏΩîÎìú ÏïûÏùò Í∞≠ ÎùΩÏùÑ Ìè¨Ìï®ÌïúÎã§.
- `REPEATABLE READ` Í≤©Î¶¨ ÏàòÏ§ÄÏóêÏÑú Ìå¨ÌÖÄ Î¶¨ÎìúÎ•º Î∞©ÏßÄÌïòÍ∏∞ ÏúÑÌïú Ïû†Í∏àÏù¥Îã§.

### AUTO-INC Locks

- `AUTO_INCREMENT` ÏπºÎ¶ºÏù¥ ÏÇ¨Ïö©Îêú ÌÖåÏù¥Î∏îÏóê ÎèôÏãúÏóê Ïó¨Îü¨ Î†àÏΩîÎìúÍ∞Ä `INSERT`ÎêòÎäî Í≤ΩÏö∞, Í∞Å Î†àÏΩîÎìúÎäî Ï§ëÎ≥µÎêòÏßÄ ÏïäÍ≥† Ï†ÄÏû•Îêú ÏàúÏÑúÎåÄÎ°ú Ï¶ùÍ∞ÄÌïòÎäî ÏùºÎ†®Î≤àÌò∏ Í∞íÏùÑ Í∞ÄÏ†∏Ïïº ÌïúÎã§.
- InnoDB Îäî ÎÇ¥Î∂ÄÏ†ÅÏúºÎ°ú AUTO-INC ÎùΩÏù¥ÎùºÍ≥† ÌïòÎäî ÌÖåÏù¥Î∏î ÏàòÏ§ÄÏùò Ïû†Í∏àÏùÑ ÏÇ¨Ïö©ÌïúÎã§.
- Ìä∏ÎûúÏû≠ÏÖòÍ≥º Í¥ÄÍ≥Ñ ÏóÜÏù¥ `INSERT`ÎÇò `REPLACE` Î¨∏Ïû•ÏóêÏÑú `AUTO_INCREMENT` Í∞íÏùÑ Í∞ÄÏ†∏Ïò§Îäî ÏàúÍ∞ÑÎßå ÎùΩÏù¥ Í±∏Î†∏Îã§Í∞Ä Ìï¥Ï†úÎêúÎã§.

### Ïû†Í∏à ÏòàÏãú

```sql
-- Î†àÏΩîÎìúÎäî id Í∏∞Ï§Ä 10, 20, 30, 40, 50Ïù¥ ÏûàÎã§Í≥† Í∞ÄÏ†ï
-- Record Locks: 10Ïóê ÎåÄÌï¥ ÎùΩÏù¥ Í±∏Î¶∞Îã§.
SELECT * FROM table_name where id = 10 for update;

-- Gap Locks: 51Î∂ÄÌÑ∞ PositiveInfinityÍπåÏßÄ ÎùΩÏù¥ Í±∏Î¶∞Îã§.
SELECT * FROM table_name where id > 100 for update;

-- Next-Key Locks: 21Î∂ÄÌÑ∞ 30, 31Î∂ÄÌÑ∞ 40Ïóê ÎùΩÏù¥ Í±∏Î¶∞Îã§.
SELECT * FROM table_name where id BETWEEN 25 AND 35 for update;
```

## Ï∞∏Í≥† ÏûêÎ£å

- [Optimistic and Pessimistic record locking, IBM](https://www.ibm.com/docs/en/rational-clearquest/9.0.0?topic=clearquest-optimistic-pessimistic-record-locking)
- [MySQL Innodb Locks, cecil1018](https://cecil1018.wordpress.com/2016/06/18/mysql-innodb-locks/)
- [MySQL 8.0 InnoDB Locks, MySQL](https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html)
- [Locks Set by Different SQL Statements in InnoDB, MySQL](https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html)